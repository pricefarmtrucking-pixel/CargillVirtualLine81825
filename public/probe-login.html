<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Probe Login â€” Cargill Soybean</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#222}
    .container{max-width:520px;margin:10vh auto;padding:0 1rem}
    .card{border:1px solid #ddd;border-radius:12px;padding:1.5rem;background:#fff;box-shadow:0 2px 12px rgba(0,0,0,.05)}
    .button{padding:.6rem 1rem;border:none;border-radius:10px;cursor:pointer}
    .button.primary{background:#1e90ff;color:#fff}
    .button.ghost{background:#f7f7f7;border:1px solid #ddd}
    .input{width:100%;padding:.7rem .8rem;border:1px solid #ccc;border-radius:10px}
    .row{display:flex;gap:.5rem;margin-top:.6rem}
    .small{font-size:.9rem;color:#555}
    #otpMsg{margin-top:.6rem;min-height:1.2em}
  </style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>Probe Sign-In</h2>
    <p class="small">Enter your mobile number to receive a one-time access code.</p>
    <label>Mobile number</label>
    <input id="phone" class="input" placeholder="+1XXXXXXXXXX" autocomplete="tel"/>
    <div class="row">
      <button id="btnSend" class="button primary" type="button">Send Code</button>
      <button id="btnResend" class="button ghost" type="button" disabled>Resend (60)</button>
    </div>
    <div id="otpMsg" class="small" style="color:#b00020;"></div>
    <div id="codeBox" style="margin-top:1rem;display:none;">
      <label>Enter 6-digit code</label>
      <input id="code" maxlength="6" class="input" inputmode="numeric" placeholder="______" style="text-align:center;"/>
      <button id="btnVerify" class="button primary" style="margin-top:.6rem;" type="button">Verify & Continue</button>
    </div>
  </div>
</div>
<script>
(function(){
  const apiBase=''; const $=id=>document.getElementById(id);
  const ok=t=>{const el=$('otpMsg');el.style.color='#0a7a28';el.textContent=t}
  const err=t=>{const el=$('otpMsg');el.style.color='#b00020';el.textContent=t}
  const norm=p=>{const d=String(p||'').replace(/\D/g,''); if(/^\d{10}$/.test(d))return '+1'+d; if(/^1\d{10}$/.test(d))return '+'+d; if(/^\+1\d{10}$/.test(d))return d; return null;}
  function cooldown(n=60){const b=$('btnResend');b.disabled=true;let t=n;b.textContent=`Resend (${t})`;const iv=setInterval(()=>{t--;b.textContent=t>0?`Resend (${t})`:'Resend';if(t<=0){clearInterval(iv);b.disabled=false;}},1000);}
  async function send(){ err(''); const phone=norm($('phone').value); if(!phone) return err('Enter valid US number');
    try{const r=await fetch(apiBase+'/auth/request-code',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone,role:'driver'}),credentials:'include'}); const j=await r.json(); if(!r.ok||j.error) return err(j.error||r.statusText); ok('Code sent!'); $('codeBox').style.display='block'; $('code').focus(); cooldown(60);}catch(e){err('server error');}}
  async function verify(){ const phone=norm($('phone').value); const code=$('code').value.trim(); if(!phone||!/^\d{6}$/.test(code)) return err('Enter 6-digit code');
    try{const r=await fetch(apiBase+'/auth/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone,code,role:'driver'}),credentials:'include'}); const j=await r.json(); if(!r.ok||j.error) return err(j.error||r.statusText); ok('Verified!'); location.href='facility-appointments.html'; }catch(e){err('server error');}}
  $('btnSend').onclick=send; $('btnResend').onclick=()=>{if(!$('btnResend').disabled) send();}; $('btnVerify').onclick=verify;
})();
</script>
</body>
</html>
